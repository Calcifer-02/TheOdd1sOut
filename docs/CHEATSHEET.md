# üìã –ò–¢–û–ì–û–í–ê–Ø –®–ü–ê–†–ì–ê–õ–ö–ê: –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è –∑–∞–¥–∞—á –≤ –ø—Ä–æ—Ñ–∏–ª–µ

## üéØ –ì–ª–∞–≤–Ω–∞—è –ø—Ä–æ–±–ª–µ–º–∞
–ó–∞–¥–∞—á–∏ —Å–æ–∑–¥–∞—é—Ç—Å—è —Å `user_id`, –Ω–æ –Ω–µ –æ—Ç–æ–±—Ä–∞–∂–∞—é—Ç—Å—è –≤ –ø—Ä–æ—Ñ–∏–ª–µ. –í `daily_stats` –≤–µ–∑–¥–µ `user_id = null`.

## ‚úÖ –ß—Ç–æ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–æ (–∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏)

### 1. useMaxUser - –ø–æ–¥–¥–µ—Ä–∂–∫–∞ debug —Ä–µ–∂–∏–º–∞
**–§–∞–π–ª**: `src/hooks/useMaxUser.ts`
- –¢–µ–ø–µ—Ä—å —á–∏—Ç–∞–µ—Ç `localStorage.getItem('debug_user_id')`
- –†–∞–±–æ—Ç–∞–µ—Ç –¥–ª—è –ª–æ–∫–∞–ª—å–Ω–æ–π —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏ –±–µ–∑ MAX WebApp

### 2. API - —É–ª—É—á—à–µ–Ω–∞ –ª–æ–≥–∏–∫–∞ daily_stats
**–§–∞–π–ª**: `src/app/api/tasks/[id]/route.ts`
- –ò—Å–ø—Ä–∞–≤–ª–µ–Ω –ø–æ–∏—Å–∫ –∑–∞–ø–∏—Å–µ–π (`.single()` ‚Üí `.select()`)
- –í—Å–µ–≥–¥–∞ –¥–æ–±–∞–≤–ª—è–µ—Ç—Å—è `user_id` –≤ insert
- –ü–æ–¥—Ä–æ–±–Ω–æ–µ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ

### 3. –ü—Ä–æ—Ñ–∏–ª—å - —É–ª—É—á—à–µ–Ω–∞ –∑–∞–≥—Ä—É–∑–∫–∞ –¥–∞–Ω–Ω—ã—Ö
**–§–∞–π–ª**: `src/app/profile/page.tsx`
- –§—É–Ω–∫—Ü–∏—è `loadProfileData(userId)` –ø—Ä–∏–Ω–∏–º–∞–µ—Ç –ø–∞—Ä–∞–º–µ—Ç—Ä
- –î–æ–±–∞–≤–ª–µ–Ω–æ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –≤ `todayStats` –∏ `weekStats`

## üõ†Ô∏è –ß—Ç–æ –Ω—É–∂–Ω–æ —Å–¥–µ–ª–∞—Ç—å –í–†–£–ß–ù–£–Æ

### ‚ö†Ô∏è –ö–†–ò–¢–ò–ß–ù–û: –û—á–∏—Å—Ç–∏—Ç—å –ë–î –∏ –∏—Å–ø—Ä–∞–≤–∏—Ç—å constraint

**–í—ã–ø–æ–ª–Ω–∏—Ç–µ –≤ Supabase SQL Editor:**

```sql
-- –§–∞–π–ª: supabase/migrations/clean_all_tables.sql
```

**–ß—Ç–æ –¥–µ–ª–∞–µ—Ç:**
1. ‚úÖ –£–¥–∞–ª—è–µ—Ç –≤—Å–µ —Ç–µ—Å—Ç–æ–≤—ã–µ –¥–∞–Ω–Ω—ã–µ
2. ‚úÖ –ò—Å–ø—Ä–∞–≤–ª—è–µ—Ç constraint –≤ daily_stats
3. ‚úÖ –°–±—Ä–∞—Å—ã–≤–∞–µ—Ç —Å—á—ë—Ç—á–∏–∫–∏ ID

**–ö–∞–∫ –≤—ã–ø–æ–ª–Ω–∏—Ç—å:**
1. –û—Ç–∫—Ä–æ–π—Ç–µ Supabase ‚Üí SQL Editor
2. –°–∫–æ–ø–∏—Ä—É–π—Ç–µ —Å–æ–¥–µ—Ä–∂–∏–º–æ–µ `clean_all_tables.sql`
3. –í—Å—Ç–∞–≤—å—Ç–µ –∏ –Ω–∞–∂–º–∏—Ç–µ Run

## üìÅ –°–æ–∑–¥–∞–Ω–Ω—ã–µ —Ñ–∞–π–ª—ã

### –ú–∏–≥—Ä–∞—Ü–∏–∏ (Supabase)
- `clean_all_tables.sql` - **–ì–õ–ê–í–ù–´–ô –°–ö–†–ò–ü–¢** –¥–ª—è –æ—á–∏—Å—Ç–∫–∏ –∏ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è
- `fix_daily_stats_constraint.sql` - —Ç–æ–ª—å–∫–æ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ constraint
- `quick_fix_daily_stats.sql` - –±—ã—Å—Ç—Ä–æ–µ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ
- `diagnostic_daily_stats.sql` - –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∞ –ø—Ä–æ–±–ª–µ–º
- `update_daily_stats_user_id.sql` - –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ user_id

### –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è
- `QUICK_CLEAN.md` - **–ù–ê–ß–ê–¢–¨ –û–¢–°–Æ–î–ê** - –±—ã—Å—Ç—Ä–∞—è —à–ø–∞—Ä–≥–∞–ª–∫–∞
- `CLEAN_ALL_TABLES.md` - –ø–æ–¥—Ä–æ–±–Ω–∞—è –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏—è –ø–æ –æ—á–∏—Å—Ç–∫–µ
- `SOLUTION_DAILY_STATS.md` - –ø–æ–ª–Ω–æ–µ —Ä—É–∫–æ–≤–æ–¥—Å—Ç–≤–æ
- `FIX_DAILY_STATS_CONSTRAINT.md` - –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ constraint
- `TEST_PROFILE_STATS.md` - –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏–∏ –ø–æ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—é
- `QUICK_FIX_CHECKLIST.md` - —á–µ–∫-–ª–∏—Å—Ç –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–π
- `SUMMARY_CHANGES.md` - —Ä–µ–∑—é–º–µ –≤—Å–µ—Ö –∏–∑–º–µ–Ω–µ–Ω–∏–π
- `CHEATSHEET.md` - —ç—Ç–æ—Ç —Ñ–∞–π–ª

## üöÄ –ë—ã—Å—Ç—Ä—ã–π —Å—Ç–∞—Ä—Ç

### –®–∞–≥ 1: –û—á–∏—Å—Ç–∏—Ç–µ –ë–î (5 –º–∏–Ω—É—Ç)
```
1. –û—Ç–∫—Ä–æ–π—Ç–µ Supabase SQL Editor
2. –í—ã–ø–æ–ª–Ω–∏—Ç–µ clean_all_tables.sql
3. –î–æ–∂–¥–∏—Ç–µ—Å—å "‚úÖ –û–ß–ò–°–¢–ö–ê –ó–ê–í–ï–†–®–ï–ù–ê!"
```

### –®–∞–≥ 2: –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ (2 –º–∏–Ω—É—Ç—ã)
```
1. –ü–µ—Ä–µ–∑–∞–≥—Ä—É–∑–∏—Ç–µ —Å—Ç—Ä–∞–Ω–∏—Ü—É (F5)
2. –û—Ç–∫—Ä–æ–π—Ç–µ –∫–æ–Ω—Å–æ–ª—å (F12)
3. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ: "üîß [useMaxUser] Debug mode: using user_id from localStorage: 123456"
```

### –®–∞–≥ 3: –°–æ–∑–¥–∞–π—Ç–µ —Ç–µ—Å—Ç–æ–≤—É—é –∑–∞–¥–∞—á—É (1 –º–∏–Ω—É—Ç–∞)
```
1. –°–æ–∑–¥–∞–π—Ç–µ –∑–∞–¥–∞—á—É
2. –í—ã–ø–æ–ª–Ω–∏—Ç–µ –µ—ë
3. –ü–µ—Ä–µ–π–¥–∏—Ç–µ –≤ –ø—Ä–æ—Ñ–∏–ª—å
4. –£–±–µ–¥–∏—Ç–µ—Å—å: "‚úÖ [ProfilePage] todayStats from daily_stats: {completed: 1, ...}"
```

## üîç –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ä–∞–±–æ—Ç—ã

### –í –∫–æ–Ω—Å–æ–ª–∏ –±—Ä–∞—É–∑–µ—Ä–∞ –¥–æ–ª–∂–Ω–æ –±—ã—Ç—å:

**–ü—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ:**
```
üîß [useMaxUser] Debug mode: using user_id from localStorage: 123456
üîÑ [ProfilePage] Loading profile data for user_id: 123456
‚úÖ [ProfilePage] Loaded X tasks
‚úÖ [ProfilePage] Loaded X completed tasks
‚úÖ [ProfilePage] Loaded X daily stats
```

**–ü—Ä–∏ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–∏ –∑–∞–¥–∞—á–∏:**
```
üì¶ Saving completed task to archive with user_id: 123456
‚úÖ Task saved to completed_tasks with user_id: 123456
üìä Updating daily_stats for user_id: 123456 date: 2025-11-11
‚úÖ Daily stats created/updated for user: 123456
```

**–í –ø—Ä–æ—Ñ–∏–ª–µ:**
```
üìä [ProfilePage] todayStat found: {date: '2025-11-11', tasks_completed: 1, user_id: 123456, ...}
‚úÖ [ProfilePage] todayStats from daily_stats: {completed: 1, goal: 5, percentage: 20}
```

## ‚ùå –ï—Å–ª–∏ —á—Ç–æ-—Ç–æ –Ω–µ —Ä–∞–±–æ—Ç–∞–µ—Ç

### –ü—Ä–æ–±–ª–µ–º–∞: user_id = undefined
**–†–µ—à–µ–Ω–∏–µ:**
```javascript
// –í –∫–æ–Ω—Å–æ–ª–∏ –±—Ä–∞—É–∑–µ—Ä–∞:
localStorage.setItem('debug_user_id', '123456');
location.reload();
```

### –ü—Ä–æ–±–ª–µ–º–∞: –û—à–∏–±–∫–∞ "duplicate key value"
**–†–µ—à–µ–Ω–∏–µ:** –í—ã–ø–æ–ª–Ω–∏—Ç–µ `clean_all_tables.sql` - –æ–Ω –∏—Å–ø—Ä–∞–≤–∏—Ç constraint

### –ü—Ä–æ–±–ª–µ–º–∞: –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –Ω–µ –æ—Ç–æ–±—Ä–∞–∂–∞–µ—Ç—Å—è
**–ü—Ä–æ–≤–µ—Ä—å—Ç–µ:**
1. –í –∫–æ–Ω—Å–æ–ª–∏: `üîß [useMaxUser] Debug mode` - –µ—Å—Ç—å?
2. –í Supabase: `SELECT * FROM daily_stats WHERE user_id = 123456` - –µ—Å—Ç—å –∑–∞–ø–∏—Å–∏?
3. –í—ã–ø–æ–ª–Ω–∏—Ç–µ –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫—É: `diagnostic_daily_stats.sql`

## üìä –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –ë–î –ø–æ—Å–ª–µ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è

```sql
-- daily_stats
CREATE TABLE daily_stats (
  id SERIAL PRIMARY KEY,
  date DATE NOT NULL,
  user_id INTEGER,
  tasks_completed INTEGER DEFAULT 0,
  goal INTEGER DEFAULT 5
);

-- –£–Ω–∏–∫–∞–ª—å–Ω—ã–π –∏–Ω–¥–µ–∫—Å –Ω–∞ (date, user_id)
CREATE UNIQUE INDEX daily_stats_date_user_id_key 
ON daily_stats (date, user_id) NULLS NOT DISTINCT;
```

## üéâ –û–∂–∏–¥–∞–µ–º—ã–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç

–ü–æ—Å–ª–µ –≤—Å–µ—Ö –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–π:
- ‚úÖ –ó–∞–¥–∞—á–∏ —Å–æ–∑–¥–∞—é—Ç—Å—è —Å –ø—Ä–∞–≤–∏–ª—å–Ω—ã–º `user_id`
- ‚úÖ –ó–∞–¥–∞—á–∏ —Å–æ—Ö—Ä–∞–Ω—è—é—Ç—Å—è –≤ `completed_tasks` —Å `user_id`
- ‚úÖ –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –æ–±–Ω–æ–≤–ª—è–µ—Ç—Å—è –≤ `daily_stats` —Å `user_id`
- ‚úÖ –ü—Ä–æ—Ñ–∏–ª—å –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ –æ—Ç–æ–±—Ä–∞–∂–∞–µ—Ç –¥–∞–Ω–Ω—ã–µ
- ‚úÖ –ù–µ—Ç –æ—à–∏–±–æ–∫ "duplicate key value"
- ‚úÖ –ê–Ω–∞–ª–∏—Ç–∏–∫–∞ —Ä–∞–±–æ—Ç–∞–µ—Ç
- ‚úÖ –ì—Ä–∞—Ñ–∏–∫–∏ –æ—Ç–æ–±—Ä–∞–∂–∞—é—Ç—Å—è

## üìö –ü–æ–ª–µ–∑–Ω—ã–µ —Å—Å—ã–ª–∫–∏

- **–ù–∞—á–∞—Ç—å —Å**: `docs/QUICK_CLEAN.md`
- **–ü–æ–ª–Ω–æ–µ —Ä—É–∫–æ–≤–æ–¥—Å—Ç–≤–æ**: `docs/SOLUTION_DAILY_STATS.md`
- **–û—á–∏—Å—Ç–∫–∞ –ë–î**: `supabase/migrations/clean_all_tables.sql`
- **–î–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∞**: `supabase/migrations/diagnostic_daily_stats.sql`

## ‚è±Ô∏è –í—Ä–µ–º—è –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è

- ‚úÖ –ö–æ–¥ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω: **0 –º–∏–Ω—É—Ç** (—É–∂–µ –ø—Ä–∏–º–µ–Ω–µ–Ω–æ)
- ‚ö†Ô∏è –û—á–∏—Å—Ç–∫–∞ –ë–î: **5 –º–∏–Ω—É—Ç** (–≤—Ä—É—á–Ω—É—é)
- ‚úÖ –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ: **3 –º–∏–Ω—É—Ç—ã**

**–ò—Ç–æ–≥–æ: 8 –º–∏–Ω—É—Ç –¥–æ –ø–æ–ª–Ω–æ—Å—Ç—å—é —Ä–∞–±–æ—á–µ–≥–æ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è**

---

**–°—Ç–∞—Ç—É—Å**: –ö–æ–¥ ‚úÖ | –ë–î ‚ö†Ô∏è (—Ç—Ä–µ–±—É–µ—Ç—Å—è –æ—á–∏—Å—Ç–∫–∞)  
**–î–∞—Ç–∞**: 2025-11-11  
**–í–µ—Ä—Å–∏—è**: Final

